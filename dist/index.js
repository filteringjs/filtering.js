!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("filteringjs",[],e):"object"==typeof exports?exports.filteringjs=e():t.filteringjs=e()}(this,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var r in s)t.o(s,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Filter:()=>m,FilterData:()=>c,Filtering:()=>a,FilteringFlow:()=>u,Group:()=>n,Item:()=>h,Parser:()=>d,Schema:()=>l});class s{#t;#e=new Map;#s=new Set;#r=new Set;constructor(t){this.#t=t}get schema(){return this.#t}get groups(){return[...this.#e.values()]}get groupNames(){return[...this.#e.keys()]}addGroup(t){this.#e.set(t.schemaGroup.name,t)}getGroup(t){return this.#e.get(t)}get filteredItems(){return[...this.#s]}addFilteredItem(t){this.#s.add(t);for(const e of t.getGroupNames())this.#e.get(e).addFilteredItem(t)}get allItems(){return[...this.#r]}addAllItem(t){this.#r.add(t);for(const e of t.getGroupNames())this.#e.get(e).addAllItem(t)}}class r{#i;#o=new Map;#s=new Set;#r=new Set;constructor(t){this.#i=t}get schemaGroup(){return this.#i}get filters(){return[...this.#o.values()]}addFilter(t){this.#o.set(t.schemaFilter.name,t)}getFilter(t){return this.#o.get(t)}addFilteredItem(t){this.#s.add(t);for(const e of t.getFilterNames(this.schemaGroup.name))this.#o.get(e).addFilteredItem(t)}addAllItem(t){this.#r.add(t);for(const e of t.getFilterNames(this.schemaGroup.name))this.#o.get(e).addAllItem(t)}}class i{#a;#s=new Set;#l=new Set;#r=new Set;constructor(t){this.#a=t}get schemaFilter(){return this.#a}get filteredItems(){return[...this.#s]}addFilteredItem(t){this.#s.add(t)}get possibleItems(){return[...this.#l]}addPossibleItem(t){this.#l.add(t)}get allItems(){return[...this.#r]}addAllItem(t){this.#r.add(t)}}function o(t,e){for(const s of e)if(t.has(s))return!0;return!1}class a{#t;#n;constructor(t,e={}){this.#t=t,this.#n=e}filter(t){const e=this.#m(this.#t);let s=[];if(this.#n.filterItem)for(const e of this.#t.items)this.#n.filterItem(e,this.#t,t)&&s.push(e);else s=[...this.#t.items];for(const t of s)e.addAllItem(t);for(const r of this.#h(s,t))e.addFilteredItem(r);return this.#c(e,s,t),e}#m(t){const e=new s(t);for(const s of t.groups){const t=new r(s);for(const e of s.filters){const s=new i(e);t.addFilter(s)}e.addGroup(t)}return e}#c(t,e,s){for(const r of t.groupNames){const i=s.clone();i.disableGroup(r);const o=this.#h(e,i);for(const e of o)for(const s of e.getFilterNames(r))t.getGroup(r).getFilter(s).addPossibleItem(e)}}#h(t,e){const s=new Set;for(const r of t){let t=!0;for(const[s,i]of e.checkedFilters)if(i.size>0&&!o(r.getFilterNames(s),i)){t=!1;break}t&&s.add(r)}return s}}class l{#e=new Map;#d=[];#u;constructor(t){this.#u=t}get groups(){return[...this.#e.values()]}get items(){return this.#d}addGroup(t){if(this.#e.has(t.name))throw new Error(`Group with name ${t.name} already added to schema. Group names have to be unique.`);this.#e.set(t.name,t)}addItem(t){this.#d.push(t)}addItems(t){for(const e of t)this.addItem(e)}get data(){return this.#u}}class n{#f;#o=new Map;#u;constructor(t,e){this.#f=t,this.#u=e}get name(){return this.#f}get filters(){return[...this.#o.values()]}addFilter(t){if(this.#o.has(t.name))throw new Error(`Filter with name ${t.name} already in group ${this.name}. Filter names have to be unique in a Group.`);this.#o.set(t.name,t)}getFilterNames(){return new Set(this.#o.keys())}get data(){return this.#u}}class m{#f;#u;constructor(t,e){this.#f=t,this.#u=e}get name(){return this.#f}get data(){return this.#u}}class h{#u;#e=new Map;constructor(t){this.#u=t}get data(){return this.#u}getGroupNames(){return new Set(this.#e.keys())}addFilter(t,e){this.#p(t).add(e)}#p(t){return this.#e.has(t)||this.#e.set(t,new Set),this.#e.get(t)}getFilterNames(t){return this.#e.has(t)?new Set(this.#e.get(t)):new Set}}class c{#g=new Map;get checkedFilters(){return this.#g}checkFilter(t,e){this.#p(t).add(e)}checkAllFilters(t){this.#p(t).clear()}#p(t){return this.#g.has(t)||this.#g.set(t,new Set),this.#g.get(t)}disableGroup(t){this.#g.delete(t)}clone(){const t=new c;for(const[e,s]of this.#g.entries())for(const r of s)t.checkFilter(e,r);return t}}class d{static#F={groupClass:"filtering-group",filterClass:"filtering-filter",itemClass:"filtering-item",itemFilterNameAttributePrefix:"data-filter",filterCheckedClass:"checked"};#n;constructor(t={}){this.#n={...d.#F,...t}}get options(){return this.#n}parseSchemaFromHtml(t,e=new l){this.parseGroupsAndFiltersFromHtml(t,e);for(const s of this.parseItemsFromHtml(t))e.addItem(s);return e}parseGroupsAndFiltersFromHtml(t,e){for(const s of t.getElementsByClassName(this.#n.groupClass)){const t=s.dataset.groupName;if(void 0===t)continue;const r=new n(t,{element:s,label:s.dataset.groupLabel});for(const t of s.getElementsByClassName(this.#n.filterClass)){const e=t.dataset.filterName;if(void 0===e)continue;const s=new m(e,{element:t,label:t.dataset.filterLabel});r.addFilter(s)}e.addGroup(r)}}parseItemsFromHtml(t){const e=[],s=new RegExp(`${this.#n.itemFilterNameAttributePrefix}-(?<groupName>.+)`,"i");for(const r of t.getElementsByClassName(this.#n.itemClass)){const t=new h({element:r});for(const{name:e,value:i}of r.attributes){const r=e.match(s);if(r){const{groupName:e}=r.groups;for(const s of i.split(/\s*,\s*/))t.addFilter(e,s)}}e.push(t)}return e}parseCheckedFilterDataFromHtml(t){const e=new c;for(const s of t.getElementsByClassName(this.#n.groupClass)){const t=s.dataset.groupName;for(const r of s.getElementsByClassName(this.#n.filterClass)){const s=r.dataset.filterName;r.classList.contains(this.#n.filterCheckedClass)&&e.checkFilter(t,s)}}return e}}class u{options;static defaultOptions={triggerFilterAfterInitializing:!0,disabledFilterClass:"disabled",filteredItemClass:"filtered"};root;schema;parser;filtering;constructor(t,e={}){this.root=t,this.options={...u.defaultOptions,...e},this.initializeParser(),this.initializeSchema(),this.initializeFiltering(),this.initializeFilterListener(),this.options.triggerFilterAfterInitializing&&this.filter()}initializeParser(t){return this.parser=new d(t),this.parser}initializeSchema(){return this.schema=this.parser.parseSchemaFromHtml(this.root),this.schema}initializeFiltering(t){return this.filtering=new a(this.schema,t),this.filtering}initializeFilterListener(){for(const t of this.root.getElementsByClassName(this.parser.options.filterClass))t.addEventListener("click",(e=>{e.preventDefault(),t.classList.contains(this.options.disabledFilterClass)||this.beforeFilter(t)&&(t.classList.toggle(this.parser.options.filterCheckedClass),this.filter())}))}beforeFilter(t){return!0}filter(){const t=this.parser.parseCheckedFilterDataFromHtml(this.root),e=this.filtering.filter(t);for(const t of e.groups)for(const e of t.filters)e.schemaFilter.data.element.classList.toggle(this.options.disabledFilterClass,0===e.possibleItems.length);for(const t of e.allItems)t.data.element.classList.toggle(this.options.filteredItemClass,!e.filteredItems.includes(t));return e}}return e})()));
//# sourceMappingURL=index.js.map